;********************************
;* SUPER SCREEN EDITER FOR CP/M	*
;*   VERSION 1.0  REVIEW 1.0	*
;*   FOR CP/M ON NEC PC-88/8001 *
;*		      N-BAS ONLY*
;*    WRITTEN BY AKIE  AUG.1983	*
;********************************
;
.Z80
;
	EXT		
;
ROMSUB	MACRO	ADR	
	CALL	ROMCAL	
	DEFW	ADR	
	ENDM		
;
BDOS	EQU	5	
;
START:			
	LD	DE,OPNMSG	
	CALL	PRSTR	
	LD	A,(5DH)	
	CP	20H	
	JP	Z,0	
;
	LD	DE,5CH	
	CALL	SETFCB	
	CALL	OPENER	
	OR	A	
	JP	Z,0	
;
	LD	HL,TXTBGN	
	DEC	HL	
	LD	(HL),13	
	INC	HL	
LOAD10:	CALL	READER	
	OR	A	
	JP	Z,0	
	LD	DE,BUFFER	
	LD	B,0	
LOAD20:	LD	A,(DE)	
	CP	10	
	JR	Z,LOAD40	
	CP	01AH	
	JR	NZ,LOAD30	
	LD	(HL),30	
	INC	HL	
	LD	(HL),13	
	INC	HL	
	LD	(HL),0	
	JR	LOAD50	
LOAD30:	LD	(HL),A	
	INC	HL	
LOAD40:	INC	DE	
	DJNZ	LOAD20	
	JR	LOAD10	
;
LOAD50:			
	LD	DE,LODMSG	
	CALL	PRSTR	
;
SCRINI::			
	ROMSU		
	LD	BC,5019H	
	ROMSUB	093AH	
	LD	HL,CONSBF	
	LD	DE,0F300H	
	LD	BC,20	
	LDIR		
	LD	HL,0F300H	
	ROMSUB	0884H	
	LD	HL,COLOR	
	LD	DE,0F300H	
	LD	BC,20	
	LDIR		
	LD	HL,0F300H	
	ROMSUB	951H	
;
INIT::			
	LD	HL,TXTBGN	
	LD	(POINTR),HL	
;
	LD	HL,(POINTR)	
	LD	A,(HL)	
	OR	A	
	CALL	Z,BACK	
	JP	MAIN	
CONSBF:	DEFM	"0,25,0,1",00	
COLOR:	DEFM	"4,0,0",00	
;
DISP:			
;
	LD	A,0CH	
	ROMSUB	0257H	
	LD	A,"<"	
	ROMSUB	0257H	
	LD	DE,TXTBGN	
	LD	HL,(POINTR)	
	PUSH	HL	
	OR	A	
	SBC	HL,DE	
	EX	(SP),HL	
	ROMSUB	05EC0H	
	LD	A,"/"	
	ROMSUB	0257H	
	POP	HL	
	ROMSUB	02D13H	
	LD	A,">"	
	ROMSUB	0257H	
;
			
	LD	A,020H	
	LD	(0F8F1H),A	
	LD	HL,(POINTR)	
	LD	B,12	
	LD	A,0DH	
	LD	DE,TXTBGN	
	DEC	DE	
	DEC	DE	
DS10:	PUSH	BC	
	LD	BC,0FFFFH	
	CPDR		
	POP	BC	
	PUSH	HL	
	OR	A	
	SBC	HL,DE	
	POP	HL	
	JR	Z,DS12	
	DJNZ	DS10	
	INC	B	
	JR	DS15	
DS12:	LD	A,B	
	DEC	A	
	JR	Z,DS15	
	PUSH	HL	
	ROMSUB	0664H	
	EX	DE,HL	
	LD	C,80	
DS13:	LD	(HL),"ÅE	
	INC	HL	
	DEC	C	
	JR	NZ,DS13	
	POP	HL	
DS15:	INC	HL	
	INC	HL	
DS20:	LD	A,B	
	PUSH	HL	
	ROMSUB	0664H	
	POP	HL	
DS30:	LD	A,(HL)	
	CP	00DH	
	JR	Z,DS50	
	LD	(DE),A	
	INC	HL	
	INC	DE	
	JR	DS30	
DS50:	INC	B	
	INC	HL	
	LD	A,25	
	CP	B	
	RET	Z	
	XOR	A	
	CP	(HL)	
	JR	NZ,DS20	
DS60:	LD	A,B	
	CP	25	
	RET	Z	
	ROMSUB	0664H	
	EX	DE,HL	
	LD	C,80	
DS70:	LD	(HL),"ÅE	
	INC	HL	
	DEC	C	
	JR	NZ,DS70	
	RET		
;
MAIN:	CALL	CUROFF	
	LD	A,020H	
	OUT	(040H),A	
	CALL	DISP	
	XOR	A	
	OUT	(040H),A	
	ROMSUB	0F75H	
	CP	00DH	
	JP	Z,NEXT1	
	CP	01FH	
	JP	Z,NEXT1	
	CP	01EH	
	JP	Z,BACK1	
	CP	00BH	
	JP	Z,TOP	
	CP	00CH	
	JP	Z,MAIN	
	CP	004H	
	JP	Z,DEL	
	CP	009	
	JP	Z,INS	
	CP	"Z"	
	JP	Z,LAST	
	CP	"B"	
	JP	Z,BACK10	
	CP	"N"	
	JP	Z,NEXT10	
	CP	01BH	
	JP	Z,ESCAPE	
	CP	01CH	
	JR	Z,EDT	
	CP	01DH	
	JR	Z,EDT	
	CP	"R"	
	JR	Z,EDT	
	CP	"H"	
	JR	Z,EDT	
	CP	020H	
	JR	C,MAIN	
;
;
EDT:	PUSH	AF	
	CALL	CURON	
	LD	HL,0100H	
	ROMSUB	03A9H	
	POP	AF	
	LD	HL,0FFFEH	
	LD	(HL),A	
	INC	HL	
	LD	(HL),0	
	DEC	HL	
	LD	(0EDC0H),HL	
	LD	A,1	
	LD	(0EA68H),A	
	CALL	LINP	
	JR	C,MAIN	
	CALL	DELETE	
	CALL	INSERT	
	JP	MAIN	
;
DELETE:	LD	HL,(POINTR)	
	XOR	A	
	LD	BC,0FFFFH	
	CPIR		
	PUSH	HL	
	LD	HL,(POINTR)	
	LD	A,00DH	
	CPIR		
	POP	DE	
	EX	DE,HL	
	OR	A	
	SBC	HL,DE	
	LD	A,L	
	DEC	A	
	OR	H	
	JP	Z,MAIN	
	LD	C,L	
	LD	B,H	
	EX	DE,HL	
	LD	DE,(POINTR)	
	LDIR		
	RET		
;
BACK:	LD	HL,(POINTR)	
	LD	DE,TXTBGN	
	PUSH	HL	
	OR	A	
	SBC	HL,DE	
	POP	HL	
	RET	Z	
	LD	A,00D	
	LD	BC,0FFFFH	
	DEC	HL	
	DEC	HL	
	CPDR		
	INC	HL	
	INC	HL	
	LD	(POINTR),HL	
	RET		
;
NEXT:	LD	HL,(POINTR)	
	LD	A,00DH	
	LD	BC,0FFFFH	
	CPIR		
	LD	A,(HL)	
	OR	A	
	RET	Z	
	LD	(POINTR),HL	
	RET		
;
TOP:	LD	HL,TXTBGN	
	LD	(POINTR),HL	
	JP	MAIN	
;
NEXT1:	CALL	NEXT	
	JP	MAIN	
BACK1:	CALL	BACK	
	JP	MAIN	
NEXT10:	LD	B,10	
NX:	PUSH	BC	
	CALL	NEXT	
	POP	BC	
	DJNZ	NX	
	JP	MAIN	
BACK10:	LD	B,10	
BAC:	PUSH	BC	
	CALL	BACK	
	POP	BC	
	DJNZ	BAC	
	JP	MAIN	
LAST:	LD	HL,TXTBGN	
	XOR	A	
	LD	BC,0FFFFH	
	CPIR		
	DEC	HL	
	LD	(POINTR),HL	
	CALL	BACK	
	JP	MAIN	
;
INSERT:	LD	HL,(POINTR)	
	XOR	A	
	LD	BC,0FFFFH	
	CPIR		
	LD	D,H	
	LD	E,L	
	LD	BC,(POINTR)	
	OR	A	
	SBC	HL,BC	
	INC	HL	
	PUSH	HL	
	LD	HL,0EC96H	
	LD	C,0	
IST10:	LD	A,(HL)	
	INC	HL	
	INC	C	
	OR	A	
	JR	NZ,IST10	
	LD	B,0	
	LD	L,E	
	LD	H,D	
	ADD	HL,BC	
	EX	DE,HL	
	PUSH	BC	
	POP	IX	
	POP	BC	
	LDDR		
	PUSH	IX	
	POP	BC	
	LD	HL,0EC96H	
	LD	DE,(POINTR)	
	LDIR		
	LD	(POINTR),DE	
	DEC	DE	
	LD	A,00DH	
	LD	(DE),A	
	RET		
;
DEL:	CALL	DELETE	
	JP	MAIN	
INS:	LD	HL,";"	
	LD	(0EC96H),HL	
	CALL	INSERT	
	CALL	BACK	
	JP	MAIN	
;
ESCAPE:			
	LD	HL,TXTBGN	
	XOR	A	
	LD	BC,0FFFFH	
	CPIR		
	DEC	HL	
	DEC	HL	
	DEC	HL	
	LD	(HL),0	
	CALL	CURON	
;
;XOR A
;
	LD	HL,00118H	
	ROMSUB	03A9H	
	JP	0	
;
CUROFF:	XOR	A	
CUR10:	LD	(0EA5FH),A	
	RET		
CURON:	LD	A,0FFH	
	JR	CUR10	
;
LINP:			
	ROMSUB	01B7EH	
	PUSH	AF	
	CALL	CHGCAP	
	POP	AF	
	RET		
CHGCAP:	LD	HL,0EC96H	
	XOR	A	
	LD	C,A	
CH10:			
	LD	A,(HL)	
	OR	A	
	RET	Z	
	CP	34	
	JR	Z,CH70	
	LD	B,A	
	LD	A,C	
	OR	A	
	LD	A,B	
	JR	NZ,CH20	
	CP	"a"	
	JR	C,CH20	
	CP	"z"	
	JR	NC,CH20	
	SUB	020H	
CH20:	LD	(HL),A	
CHE:	INC	HL	
	JR	CH10	
CH70:	LD	A,C	
	CPL		
	LD	C,A	
	JR	CHE	
;
ROMCAL:			
	PUSH	AF	
	CALL	ROM	
	POP	AF	
	LD	(0FFF0H),HL	
	LD	(0FFF2H),DE	
	POP	HL	
	LD	E,(HL)	
	INC	HL	
	LD	D,(HL)	
	INC	HL	
	PUSH	HL	
	EX	DE,HL	
	LD	DE,ROMC10	
	PUSH	DE	
	PUSH	HL	
	LD	HL,(0FFF0H)	
	LD	DE,(0FFF2H)	
	RET		
ROMC10:			
	PUSH	AF	
	CALL	RAM	
	POP	AF	
	RET		
;
ROM:	LD	A,4	
RRR:	OUT	(031H),A	
	RET		
RAM:	LD	A,6	
	JR	RRR	
;
OPNMSG:	DEFM	"SUPER SCREEN EDITER VERSION 0.1 BY AKIE"	
	DEFB	0DH,0AH,'$'	
LODMSG:	DEFM	"TEXT FILE WAS LOADED"	
	DEFB	0DH,0AH,'$'	
;
ZZZZZZ:			
;
	END		
